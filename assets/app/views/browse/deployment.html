<div ng-controller="DeploymentController">
  <project-page>
    <breadcrumbs breadcrumbs="breadcrumbs"></breadcrumbs>
    <alerts alerts="alerts"></alerts>
    <div class="well deployment-well" ng-if="deployment">
      <div class="row">
        <div class="col-md-12">
          <div class="deployment-detail" style="margin-bottom:15px;">
            <span class="deployment-detail-label">Status:</span>
            <span ng-switch="deploymentStatus(deployment)" class="hide-ng-leave">
              <span ng-switch-when="Cancelled" class="fa fa-ban text-warning" aria-hidden="true"></span>              
              <span ng-switch-when="Deployed" class="fa fa-check text-success" aria-hidden="true"></span>
              <span ng-switch-when="Complete" class="fa fa-check text-success" aria-hidden="true"></span>
              <span ng-switch-when="Failed" class="fa fa-times text-danger" aria-hidden="true"></span>
              <span ng-switch-when="New" class="spinner spinner-xs spinner-inline" aria-hidden="true"></span>
              <span ng-switch-when="Pending" class="spinner spinner-xs spinner-inline" aria-hidden="true"></span>
              <span ng-switch-default class="fa fa-refresh fa-spin" aria-hidden="true"></span>
            </span>
            {{deploymentStatus(deployment)}} 
            <span style="margin-left: 7px;">
              <button ng-show="!rollBackCollapsed && deploymentStatus(deployment) == 'Complete' && !deploymentIsLatest(deploymentConfig, deployment)" ng-disabled="(deploymentConfigDeploymentsInProgress[deploymentConfigName] | hashSize) > 0" type="button" class="btn btn-primary" ng-click="rollBackCollapsed = !rollBackCollapsed">Roll Back</button>
              <div ng-show="rollBackCollapsed" class="well well-sm">
                Use the following settings from {{deployment.metadata.name}} when rolling back: 
                <div class="checkbox">
                  <label>
                    <input type="checkbox" ng-model="changeScaleSettings" ng-disabled="(deploymentConfigDeploymentsInProgress[deploymentConfigName] | hashSize) > 0"> replica count and selector
                  </label>
                </div>
                <div class="checkbox">
                  <label>
                    <input type="checkbox" ng-model="changeStrategy" ng-disabled="(deploymentConfigDeploymentsInProgress[deploymentConfigName] | hashSize) > 0"> deployment strategy
                  </label>
                </div>
                <div class="checkbox">
                  <label>
                    <input type="checkbox" ng-model="changeTriggers" ng-disabled="(deploymentConfigDeploymentsInProgress[deploymentConfigName] | hashSize) > 0"> deployment trigger
                  </label>
                </div>
                <button type="button" ng-click="rollbackToDeployment(deployment, changeScaleSettings, changeStrategy, changeTriggers)" ng-disabled="(deploymentConfigDeploymentsInProgress[deploymentConfigName] | hashSize) > 0" class="btn btn-primary">Roll Back</button>
              </div>
              <!-- disabled until we have an api endpoint for retry
              <button ng-show="deploymentStatus(deployment) == 'Failed'" type="button" ng-click="retryFailedDeployment(deployment)" ng-disabled="(deploymentConfigDeploymentsInProgress[deploymentConfigName] | hashSize) > 0" class="btn btn-primary" ng-if="deploymentIsLatest(deploymentConfig, deployment)">Retry</button>
              -->
              <button ng-show="deploymentIsInProgress(deployment)" type="button" ng-click="cancelRunningDeployment(deployment)" class="btn btn-primary">Cancel</button>
            </span>                
          </div>
          <div class="deployment-detail" ng-if="isDeployment(deployment)">
            <span class="deployment-detail-label">Deployment config:</span>
            <a href="project/{{deployment.metadata.namespace}}/browse/deployment/{{deploymentConfigName}}">{{deploymentConfigName}}</a>
          </div>
          <div class="deployment-detail">
            <span class="deployment-detail-label">Created:</span><relative-timestamp timestamp="deployment.metadata.creationTimestamp"></relative-timestamp>
          </div>
          <div class="deployment-detail" ng-if="deployment | annotation:'deploymentStatusReason'">
            <span class="deployment-detail-label">Status reason:</span>
            {{deployment | annotation:'deploymentStatusReason'}}
          </div>
          <div class="deployment-detail" ng-if="deploymentIsInProgress(deployment)">
            <span class="deployment-detail-label">Duration:</span>
            <span ng-switch="deploymentStatus(deployment)" class="hide-ng-leave">
              <span ng-switch-when="Running">running for <duration-until-now timestamp="deployment.metadata.creationTimestamp"></duration-until-now></span>
              <span ng-switch-default>waiting for <duration-until-now timestamp="deployment.metadata.creationTimestamp"></duration-until-now></span>
            </span>
          </div>
          <div class="deployment-detail">
            <span class="deployment-detail-label">Labels:</span>
            <span ng-if="!deployment.metadata.labels">none</span>
            <span ng-repeat="(labelKey, labelValue) in deployment.metadata.labels">{{labelKey}}={{labelValue}}<span ng-show="!$last">, </span></span>
          </div>
          <div class="deployment-detail">
            <span class="deployment-detail-label">Selectors:</span>
            <span ng-if="!deployment.spec.selector">none</span>
            <span ng-repeat="(labelKey, labelValue) in deployment.spec.selector">{{labelKey}}={{labelValue}}<span ng-show="!$last">, </span></span>
          </div>
          <div class="deployment-detail">
            <span class="deployment-detail-label">Replicas:</span>
            {{deployment.status.replicas}} current / {{deployment.spec.replicas}} desired
          </div>
          <div class="deployment-detail">
            <span>Pod template:</span>
            <pod-template
              pod-template="deployment.spec.template" 
              images-by-docker-reference="imagesByDockerReference"
              builds="builds"></pod-template>
          </div>
        </div><!-- .col -->
      </div>    
    </div>
  </project-page>
</div>